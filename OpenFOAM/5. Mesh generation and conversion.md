## 第 5 章 网格生成和转换

本章描述了与在 OpenFOAM 中创建网格相关的所有主题：第 [5.1](https://cfd.direct/openfoam/user-guide/v9-mesh-description#x24-1680005.1)节概述了在 OpenFOAM 中描述网格的方式；第 [5.3](https://cfd.direct/openfoam/user-guide/v9-blockMesh#x26-1850005.3)节介绍了用于生成六面体单元块的简单网格的*blockMesh实用程序；*第 [5.4](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh#x27-1970005.4)节介绍了*snappyHexMesh*实用程序，用于从三角表面几何图形自动生成复杂的六面体和分裂六面体单元网格；第 [5.5](https://cfd.direct/openfoam/user-guide/v9-mesh-conversion#x28-2070005.5)节描述了可用于将第三方产品生成的网格转换为 OpenFOAM 可以读取的格式的选项。

## 5.1 网格描述



本节提供了 OpenFOAM C++ 类处理网格方式的规范。网格是数值解的一个组成部分，必须满足一定的标准以确保一个有效的、因此是准确的解。在任何运行过程中，OpenFOAM 都会检查网格是否满足一组相当严格的有效性约束，如果不满足约束将停止运行。

默认情况下，OpenFOAM 在 3-D 中定义任意多面体单元的网格，以任意多边形面为界，*即*单元可以有无限数量的面，对于每个面，边的数量没有限制，也没有限制它的对齐方式。具有这种一般结构的网格在 OpenFOAM 中称为*polyMesh*. 这种类型的网格在网格生成和操作方面提供了很大的自由度，特别是当域的几何形状复杂或随时间变化时。

### 5.1.1 网格规范和有效性约束



在描述 OpenFOAM 网格格式之前，我们将首先列出 OpenFOAM 中使用的有效性约束。网格必须满足的条件是：

#### 5.1.1.1 积分

点是 3-D 空间中的位置，由以米为单位的向量 ( ![米](https://cdn.cfd.direct/docs/user-guide-v9/img/user349x.png)) 定义。这些点被编译成一个列表，每个点都由一个标签引用，该标签代表它在列表中的位置，从零开始。*点列表不能包含* *位于完全相同位置的两个不同点，也不能包含任何不属于* *至少一个面的点。* 

#### 5.1.1.2 面孔

面是点的有序列表，其中点由其标签引用。面中点标签的顺序是这样的，即每两个相邻点都由一条边连接，*即*当您沿着面的圆周移动时，您会跟随点。面被编译成一个列表，每个面都由它的标签引用，代表它在列表中的位置。人脸法向量的方向由右手定则定义，*即*看向人脸，如果点的编号遵循逆时针路径，则法向量指向您，如图 [5.1](https://cfd.direct/openfoam/user-guide/v9-mesh-description/#x24-1710011)所示。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user350x.png)

图 5.1：面部点编号的面部区域向量

有两种类型的脸，如下所述。

- *内部面*，连接两个单元格（不能超过两个）。对于每个内部面，点标签的顺序是使得面法线指向具有较大标签的单元格，*即*对于单元格 2 和 5，法线指向 5。
- *边界面*，属于一个单元格，因为它们与域的边界重合。因此，边界面由一个单元（仅）和一个边界补丁来处理。点标签的排序使得人脸法线点在计算域之外。

请注意，面可以扭曲，即面的点不一定位于平面上。

#### 5.1.1.3 细胞

单元格是按任意顺序排列的面列表。单元格必须具有下面列出的属性。

- 单元必须是*连续的*，*即*完全覆盖计算域并且不能相互重叠。
- 每个单元格必须在*几何上是封闭*的，这样当所有面部区域向量都指向单元格的外部时，它们的总和应该等于零向量到机器精度；
- 每个单元必须在*拓扑上是封闭*的，这样单元中的所有边都被所讨论单元的两个面使用。

#### 5.1.1.4 边界

边界是一个补丁列表，每个补丁都与一个边界条件相关联。补丁是一个面标签列表，它显然必须只包含边界面而没有内部面。要求边界是封闭的，*即*所有边界面面积矢量之和等于零以表示机器公差。

### 5.1.2 *多边形*网格描述

*常量*目录包含案例*polyMesh*的完整描述在子目录*polyMesh*. *polyMesh*描述基于面，并且如前所述，内部面连接 2 个单元，边界面处理一个单元和一个边界补丁。因此，每个面都被分配了一个“所有者”单元格和“邻居”单元格，以便可以通过所有者和邻居单元格标签简单地描述给定面的连通性。在边界的情况下，连接的小区是所有者，邻居被分配标签'-1'。考虑到这一点，I/O 规范由以下文件组成：

- *积分*

  描述单元格顶点的向量列表，其中列表中的第一个向量表示顶点 0，第二个向量表示顶点 1，*以此类推* ；

- *面孔*

  面列表，每个面是点列表中顶点的索引列表，同样，列表中的第一个条目表示面 0，*等等* ；

- *所有者*

  所有者单元格标签列表，条目索引与面部索引直接相关，因此列表中的第一个条目是面部 0 的所有者标签，第二个条目是面部 1 的所有者标签，等等；

- *邻居*

  相邻小区标签列表；

- *边界*

  补丁列表，包含每个补丁的字典条目，使用补丁名称声明，*例如*MovingWall  { 类型 补丁； nFaces  20； 开始面 760; }          起始面是面片中第一个面的面列表中的索引，nFaces是面片中的面数。

### 5.1.3 单元格形状

虽然 OpenFOAM 支持任何形状的单元格，但其他工具和软件通常不支持。因此，网格与 OpenFOAM 格式之间的转换通常需要使用定义的单元形状，例如四面体、六面体*等。*该功能在*cellShape类中可用，该类使用在*$ *FOAM* *_ETC中的**cellModels*文件中定义的一组形状目录。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user351x.png)(a) 六面体：关键字hex



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user352x.png)(b) Wedge：关键字wedge



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user353x.png)(c) 棱镜：关键词棱镜



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user354x.png)(d) 金字塔：关键词pyr



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user355x.png)(e) 四面体：关键词tet



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user356x.png)(f) 四面体楔形：关键词tetWedge

图 5.2：*cellShape*的顶点、面和边编号

然后根据形状模型中包含的编号方案，通过点标签的排序来定义给定形状的单元格。作为参考，点、面和边的排序方案如表 [5.2](https://cfd.direct/openfoam/user-guide/v9-mesh-description/#x24-1750072)所示。任何单元描述都由两部分组成：单元模型的名称和标签的有序列表。因此，使用以下点列表


  (  (0  0  0)  (1  0  0)  (1  1  0)  (0  1  0)  (0  0  0.5)  (1  0  0.5)  (1  1  0.5)  (0  1  0.5)  )
    
    
    
    
    
    
    
    


六面体单元格将使用关键字hex编写如下。


  （十六进制 8（0  1  2  3  4  5  6  7））

这构成了*blockMesh* 网格生成器的输入语法的基础，如第 [5.3](https://cfd.direct/openfoam/user-guide/v9-blockMesh#x26-1850005.3)节所述。

### 5.1.4 一维和二维以及轴对称问题



OpenFOAM 被设计为 3 维空间的代码，并以此定义所有网格。然而，可以在 OpenFOAM 中模拟 1 维和 2 维以及轴对称问题，方法是生成 3 维网格并在垂直于感兴趣方向的平面中的任何面片上应用特殊的边界条件。更具体地说，一维和二维问题使用*空*补丁类型和轴对称问题使用*楔形*类型。[5.2.2](https://cfd.direct/openfoam/user-guide/v9-boundaries#x25-1790005.2.2)节描述了两者的使用， [5.3.5](https://cfd.direct/openfoam/user-guide/v9-blockMesh#x26-1950005.3.5)节讨论了轴对称问题的楔形几何的生成 。



## 5.2 边界



在本节中，我们将讨论 OpenFOAM 中处理边界的方式。边界的主题相当复杂，因为它们在建模中的作用不仅仅是几何实体，而是通过边界条件或跨边界“连接”的解决方案和数值的组成部分。边界的讨论在网格、场、离散化、计算处理*等 的讨论之间令人不安。*

我们首先需要考虑的是，为了应用边界条件，一个边界通常被分解为一组*补丁*。一个贴片可以包括边界表面的一个或多个封闭区域，这些区域不一定需要物理连接。[作为网格描述的一部分，作为第5.1.2节中描述的](https://cfd.direct/openfoam/user-guide/v9-mesh-description#x24-1740005.1.2)*边界*文件 的一部分，为每个补丁分配一个类型。它根据几何形状或数据“通信链路”来描述补丁的类型。下面显示了*rhoPimpleFoam*案例的示例*边界文件。*每个补丁（入口、出口、*等* ），分配的类型包括patch、SymmetryPlane和empty。

16 //  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  *  //  _  _  _
17
18 6
19 (
20 进口  
21 {  
22 型 贴片；         
23 nFaces  50；        
24 开始面 10325  ;       
25 }  
26个 插座  
27 {  
28 型 贴片；         
29 nFaces  40；        
30 开始面 10375  ;       
31 }  
32 底  
33 {  
34 型 对称平面；         
第 1 组中35个（对称 平面 ）；       
36 nFaces  25；        
37 开始面 10415  ;       
38 }  
39 顶  
40 {  
41 型 对称平面；         
第 1 组中42个（对称 平面 ）；       
43 nFaces  125；        
44 开始面 10440  ;       
45 }  
46 障碍物  
47 {  
48 型 贴片；         
49 nFaces  110；        
50 startFace  10565;       
51 }  
52 个 默认人脸  
53 {  
54 型 空；         
 第1 组55 个（空）；       
56 个 nFaces  10500；        
57 开始面 10675  ;       
58 }  
59 )
60
61 //  ***************************************************** ******************************  //

用户可以浏览教程以获取网格生成配置文件，*例如* *blockMeshDict*用于*blockMesh* （请参阅第 [5.3](https://cfd.direct/openfoam/user-guide/v9-blockMesh#x26-1850005.3)节）和*snappyHexMeshDict*用于*snappyHexMesh*（请参阅第 [5.4](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh#x27-1970005.4)节，以了解正在使用的不同类型的示例。以下示例提供了文档并列出了使用*SymmetryPlane的案例*健康）状况。


  泡沫信息 -a 对称平面

下一个示例搜索指定*墙的**snappyHexMeshDict文件*健康）状况。


  查找$ FOAM _TUTORIALS  -name  snappyHexMeshDict  |  \\  xargs  grep  -El  "type[\\t  ]*wall" 
    



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user357x.png)

图 5.3：使用*楔形*贴片类型 的轴对称几何。

### 5.2.1 几何（约束）补丁类型

OpenFOAM 中可用的主要几何类型总结如下。这不是一个完整的列表; 对于所有类型，请参见$ *FOAM* *_SRC/finiteVolume/fields/fvPatchFields/constraint*。

- *修补*：通用类型，不包含有关网格的几何或拓扑信息，*例如*用于入口或出口。
- *墙*：对于与实体墙重合的补丁，一些物理建模需要，*例如* 湍流建模中的墙功能。
- *对称平面*：对于作为对称平面的平面贴片。
- *对称*：对于使用对称平面（滑动）条件的任何（非平面）补丁。
- *空的*：对于 2（或 1）维 (2D/1D) 中的解决方案，在每个补丁上使用的类型，其平面垂直于第 3（和第 2）维，不需要解决方案。
- *楔*: 对于二维轴对称情况， *例如*  圆柱体，几何形状被指定为小角度（*例如* ![1∘](https://cdn.cfd.direct/docs/user-guide-v9/img/user358x.png)）和 1 个单元格厚的楔形，沿中心线延伸，横跨其中一个坐标平面，如图 [5.3](https://cfd.direct/openfoam/user-guide/v9-boundaries/#x25-1770993)所示；轴对称楔平面必须指定为单独的*楔块*类型。
- *循环的*： 使两个补丁可以被视为物理连接；用于重复几何；一个*循环补丁通过**边界*文件中的neighbourPatch关键字链接到另一个；每对连接面的面积必须在*边界*文件中matchTolerance关键字给出的容差范围内。
- *循环AMI*: 类似*cyclic*，但是对于 2 个面不匹配的补丁；用于旋转几何情况下的滑动界面。
- *处理器*：描述为并行运行而分解的网格的处理器间边界的类型。



### 5.2.2 基本边界条件

边界条件在字段文件中指定，*例如* *p*，*U*，在时间目录中，如 [4.2.8](https://cfd.direct/openfoam/user-guide/v9-basic-file-format#x17-1310004.2.8)节所述。下面显示了一个示例压力场文件*p*，用于*rhoPimpleFoam*案例，对应于第[5.2.1节中介绍的](https://cfd.direct/openfoam/user-guide/v9-boundaries/#x25-1780005.2.1)*边界*文件 。

16维 [1  -1  -2  0  0  0  0]；   
17
18内部 场统一 1； 
19
20边界场
21 {
22 入口  
23 {  
24 类型 固定值；         
25 值 统一 1；         
26 }  
27
28 个插座  
29 {  
30 型 透波；         
31 字段 p;         
32 psi 热：psi；          
33 伽马 1.4；         
34 场 信息 1；       
35 lInf  3;         
36个 值 统一 1个；         
37 }  
38
39 底  
40 {  
41 型 对称平面；         
42 }  
43
44 顶  
45 {  
46 型 对称平面；         
47 }  
48
49 障碍物  
50 {  
51 类型 zeroGradient;         
52 }  
53
54 个 默认人脸  
55 {  
56 型 空；         
57 }  
58 }
59
60 //  ***************************************************** ******************************  //

每个补丁都包含一个指定边界条件类型的类型条目。它们的范围从应用于入口的基本固定值条件到应用于出口的复杂波传输条件。具有非泛型类型的补丁，*例如 在**boundary*中定义的*SymmetryPlane ，在**p*文件中使用一致的边界条件类型。 

OpenFOAM 中可用的主要基本边界条件类型在下面使用名为![问](https://cdn.cfd.direct/docs/user-guide-v9/img/user359x.png). 这不是一个完整的列表; 对于所有类型，请参见$ *FOAM* *_SRC/finiteVolume/fields/fvPatchFields/basic*。

- *固定值*: 的值![问](https://cdn.cfd.direct/docs/user-guide-v9/img/user359x.png)由值指定.

- *固定梯度*![问](https://cdn.cfd.direct/docs/user-guide-v9/img/user361x.png) : ( ) 的法线梯度 ![∂Q∕∂n](https://cdn.cfd.direct/docs/user-guide-v9/img/user362x.png)由梯度指定。

- *零梯度*: 的正常梯度![问](https://cdn.cfd.direct/docs/user-guide-v9/img/user361x.png)为零。

- *计算出来的*：![问](https://cdn.cfd.direct/docs/user-guide-v9/img/user361x.png)从其他补丁字段计算的补丁字段。

- 混合

  

  

  : 混合

  的 fixedValue

   / 

  fixedGradient

  条件取决于

  valueFraction

   

  

  其中

  | ![                   { valueFraction = 1 对应 Q = refValue，0 对应 ∂Q ∕∂n = refGradient。](https://cdn.cfd.direct/docs/user-guide-v9/img/user366x.png) | (5.1) |
  | ------------------------------------------------------------ | ----- |
  |                                                              |       |

- *方向混合*:带有张量值Fraction的*混合*条件，以允许向量块场的法线和切线方向上的不同条件，*例如* *切线*方向上的固定值，法线方向上的*零梯度*。



### 5.2.3 派生类型

从基本条件衍生出许多更复杂的边界条件。例如，很多复杂的条件都是从*fixedValue*派生的，其中的值是通过其他面片字段、时间、几何信息*等*的函数计算得出的。一些其他的条件是从*fixedValue*和*fixedGradient*（通常是*zeroGradient*）之间切换的*混合*/*方向混合。*

用户可以通过多种方式列出 OpenFOAM 中可用的边界条件，其中*-listScalarBCs*和*-listVectorBCs*实用程序最快。标量场和矢量场的边界条件可以分别针对给定求解器（*例如* *simpleFoam* ）列出，如下所示。


  simpleFoam  -listScalarBCs  -listVectorBCs

这些会产生用户可以浏览的长列表。如果用户想要特定条件的更多信息，他们可以运行*foamInfo*提供边界条件描述并列出使用它的示例情况的脚本。例如，对于总*压力*边界条件，运行以下命令。


  泡沫信息总 压力

在接下来的部分中，我们将重点介绍一些特别重要的、常用的边界条件。

#### 5.2.3.1 入口/出口条件

入口*出口*condition 是从*mixed派生的，当流体在面**片面*上流出域时，它在zeroGradient和流体流入域时的*fixedValue*之间切换。对于流入，入口值由入口值指定入口。*在damBreak*教程中可以看到一个很好的使用示例，它被应用于高层大气边界的相分数。在有流出的地方，条件适定，在有流入的地方，相分数固定为 0，对应于 100% 的空气。

16维 [0  0  0  0  0  0  0]；   
17
18内部 字段统一 为 0； 
19
20边界场
21 {
22 左墙  
23 {  
24 类型 zeroGradient;         
25 }  
26
27 右墙  
28 {  
29 类型 zeroGradient;         
30 }  
31
32 下墙  
33 {  
34 类型 zeroGradient;         
35 }  
36
37个 大气压  
38 {  
39 型 入口出口；         
40 入口值 统一 为 0；      
41 值 统一 为 0；         
42 }  
43
44 个 默认人脸  
45 {  
46 型 空；         
47 }  
48 }
49
50 //  ************************************************* ******************************  //



#### 5.2.3.2 夹带边界条件

*总压力*的组合压力和*压力条件InletOutletVelocity*对于发生一些流入且入口流速未知的斑块，开启速度非常常见。这包括*damBreak教程中的*大气边界、仅知道压力的入口条件、可能发生流动反转的出口以及夹带流动的情况，*例如* 在通过喷嘴的射流周围的边界上。

总*压力*条件指定

| ![    { p0 流出 p = p0 - 1\|U2 \|  用于流动（不可压缩，亚音速）2](https://cdn.cfd.direct/docs/user-guide-v9/img/user367x.png) | (5.2) |
| ------------------------------------------------------------ | ----- |
|                                                              |       |

用户![p0](https://cdn.cfd.direct/docs/user-guide-v9/img/user368x.png)通过p0关键字指定的位置。*pressureInletOutletVelocity*条件始终指定*zeroGradient*，但切向分量除外，切向分量设置为*固定*值以用于流入，*切向*速度默认为 0。

这种组合背后的想法是，条件是流出情况下的标准组合，但流入情况下，允许法向速度找到自己的值。在这些情况下，速度的快速上升会带来不稳定的风险，但随着流入速度的增加，入口压力的降低和驱动压力梯度的降低会缓和这种上升。

*在damBreak情况下，* *U*和*p_rgh*文件中这些边界条件的说明*如下*所示。

16
17个维度 [0  1  -1  0  0  0  0]；   
18
19内部 场统一 （0  0  0）； 
20
21边界场
22 {
23 左墙  
24 {  
25 型 无滑移；         
26 }  
27 右墙  
28 {  
29 型 无滑移；         
30 }  
31 下墙  
32 {  
33 型 noSlip；         
34 }  
35 个大气压  
36 {  
37 型 压力InletOutletVelocity；         
38个 值 统一 （0  0  0）；         
39 }  
40 个 默认人脸  
41 {  
42 型 空；         
43 }  
44 }
45
46
47 //  ******************************************************* ******************************  //

16维 [1  -1  -2  0  0  0  0]；   
17
18内部 字段统一 为 0； 
19
20边界场
21 {
22 左墙  
23 {  
24 型 固定磁通压力；         
25 值 统一 为 0；         
26 }  
27
28 右墙  
29 {  
30 型 固定磁通压力；         
31 值 统一 为 0；         
32 }  
33
34 下墙  
35 {  
36 型 固定磁通压力；         
37 值 统一 为 0；         
38 }  
39
40个 大气压  
41 {  
42 型 总压力；         
43 p0 统一 0；          
44 }  
45
46 个 默认人脸  
47 {  
48 型 空；         
49 }  
50 }
51
52 //  ******************************************************* ******************************  //



#### 5.2.3.3 固定通量压力

在上面的例子中，可以看出所有的墙壁边界都使用了一个名为*fixedFluxPressure*的边界条件。此边界条件用于通常使用*zeroGradient*但解方程中存在重力和表面张力等体力的情况下的压力。条件相应地调整梯度。

#### 5.2.3.4 时变边界条件

有几个边界条件，其中一些输入参数由时间函数（使用*Function1*功能）类指定。可以通过以下命令搜索它们。


  查找$ FOAM _SRC/finiteVolume/fields/fvPatchFields  -type  f  -name  "*.H"  |\\  xargs  grep  -l  Function1  |  xargs 目录名 |  种类 
    

它们包括诸如*uniformFixedValue 之类的条件*，这是一个*固定值*通过uniformValue应用作为时间函数的单个值的条件关键字词条。

*Function1*由uniformValue后面的关键字指定条目，后跟与特定功能相关的参数。*Function1*选项如下所列。

- 持续的: 常数值。
- 桌子：（时间值）对的内联列表；在时间之间线性插值。
- 表格文件: 同上，但数据在单独的文件中提供。
- 正方形: 方波函数。
- 方脉冲：单方脉冲。
- 正弦: 正弦函数。
- 一和零：恒定的一和零值。
- 多项式：使用列表（系数指数）对的多项式函数。
- 编码：用户编码指定的功能。
- 规模：通过标量缩放函数缩放给定的值函数；两个条目本身都可以是*Function1*；scale函数通常是一个斜坡函数（如下），其值控制斜坡值。
- 线性斜坡,二次斜坡,半余弦斜坡,四分之一余弦斜坡和四分之一正弦斜坡：单调斜坡函数，在指定的持续时间内从 0 斜坡上升到 1。
- 反向斜坡：反转斜坡函数的值，例如从 1 到 0。

下面显示了标量的示例或随时间变化的入口。

进口
{
  输入 统一固定值；    
  uniformValue 常量 2;
}

进口
{
  输入 统一固定值；    
  统一值 表 （（0  0） （10  2））；
}

进口
{
  输入 统一固定值；    
  uniformValue 多项式 ((1  0)  (2  2));  //  =  1*t^0  +  2*t^2
}

进口
{
  输入 统一固定值；    
  统一值
  {
    输入 表格文件；      
    格式 .csv；     
    nHeaderLine  4;  // 标题 行 数 _         
    参考列 0； // 时间 列 索引          
    组件列 （1）； // 数据 列 索引      
    分隔符 “，”； // 可选 （默认 为 “，”）         
    没有合并分隔符 ； // 合并 多个 分隔符       
    文件 “dataTable.csv”；      
  }
}

进口
{
  输入 统一固定值；    
  统一值
  {
    输入 正方形；      
    频率 10；    
    幅度 1；    
    规模 2;  // 波浪 的 比例 因子      
    1级 ； // 偏移量      
  }
}

进口
{
  输入 统一固定值；    
  统一值
  {
    输入 正弦；      
    频率 10；    
    幅度 1；    
    规模 2;  // 波浪 的 比例 因子      
    1级 ； // 偏移量      
  }
}

输入 // 从 0  ->  2 斜坡， 从 t  =  0  ->  0.4 
{
  输入 统一固定值；    
  统一值
  {
    类型 规模;      
    缩放 线性斜坡；      
    从 0 开始；      
    持续时间 0.4；    
    值 2；      
  }
}

输入 // 从 2  ->  0 斜坡， 从 t  =  0  ->  0.4 
{
  输入 统一固定值；    
  统一值
  {
    类型 规模;      
    缩放 反向斜坡；      
斜坡线性斜坡 ；      
    从 0 开始；      
    持续时间 0.4；    
    值 2；      
  }
}

入口 // 值为 2的 脉冲 ， 从 t  =  0  ->  0.4 
{
  输入 统一固定值；    
  统一值
  {
    类型 规模;      
刻度 方脉冲      
    从 0 开始；      
    持续时间 0.4；    
    值 2；      
  }
}

进口
{
  输入 统一固定值；      
  统一值 编码；  
  名 脉；      
  代码包括
  \#{
    \#include  "mathematicalConstants.H"
  \#};

  代码
  \#{
    返回 标量
    (
      0.5*(1  -  cos(常数::数学::twoPi*min(x/0.3,  1)))
    );
  \#};
}



## 5.3 *使用blockMesh*实用程序生成网格

本节介绍网格生成实用程序*blockMesh*，随 OpenFOAM 提供。*blockMesh*实用程序创建带有分级的参数网格和弯曲的边缘。

网格是从名为*blockMeshDict的字典文件生成的*位于案例的*系统*（或*constant/polyMesh*）目录中。*blockMesh*读取该字典，生成网格并将网格数据写入*点*和*面孔*,*细胞*和*边界*同一目录下的文件。

*blockMesh*背后的原理是将域几何分解为一组 1 个或多个三维六面体块。块的边缘可以是直线、圆弧或样条。网格表面上被指定为块的每个方向上的多个单元格，为块网格生成网格数据提供了足够*的*信息。

每个几何块由 8 个顶点定义，一个位于六面体的每个角。顶点被写在一个列表中，这样每个顶点都可以使用它的标签来访问，记住 OpenFOAM 总是使用 C++ 约定，列表的第一个元素有标签'0'。图 [5.4](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850174)显示了一个示例块，每个顶点根据列表编号。连接顶点 1 和 5 的边是弯曲的，以提醒读者可以在*blockMesh*中指定弯曲的边。

[如第5.3.5](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1950005.3.5)节所述，可以通过将一对或多对顶点相互折叠来生成少于 8 个顶点的块 。

每个块都有一个![(x1,x2,x3)](https://cdn.cfd.direct/docs/user-guide-v9/img/user369x.png)必须是右手坐标系的局部坐标系. 定义了一组右手轴，使得对于向下看![盎司](https://cdn.cfd.direct/docs/user-guide-v9/img/user370x.png)轴的观察者来说，离轴最近的点从轴上的一点到轴上的![○](https://cdn.cfd.direct/docs/user-guide-v9/img/user371x.png)一点的弧是顺时针方向的。![牛](https://cdn.cfd.direct/docs/user-guide-v9/img/user372x.png)![奥伊](https://cdn.cfd.direct/docs/user-guide-v9/img/user373x.png)

局部坐标系由顶点在块定义中呈现的顺序定义，根据：

- 轴原点是块定义中的第一个条目，在我们的示例中为顶点 0；
- 通过![x1](https://cdn.cfd.direct/docs/user-guide-v9/img/user374x.png)从顶点 0 移动到顶点 1 来描述方向；
- 通过![x2](https://cdn.cfd.direct/docs/user-guide-v9/img/user375x.png)从顶点 1 移动到顶点 2 来描述方向；
- 顶点 0、1、2、3 定义平面![x3 = 0](https://cdn.cfd.direct/docs/user-guide-v9/img/user376x.png)；
- 顶点 4 是通过从顶点 0![x3](https://cdn.cfd.direct/docs/user-guide-v9/img/user377x.png)沿方向移动找到的；
- ![x3](https://cdn.cfd.direct/docs/user-guide-v9/img/user378x.png) 通过分别从顶点 1,2 和 3的方向移动，类似地找到顶点 5,6 和 7 。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user379x.png)

图 5.4：单个块



| 关键词     | 描述                         | 示例/选择                                                    |
| ---------- | ---------------------------- | ------------------------------------------------------------ |
| 转换为米   | 顶点坐标的比例因子           | 0.001刻度为 mm                                               |
| 顶点       | 顶点坐标列表                 | (0 0 0)                                                      |
| 边缘       | 用来形容 弧线 或样条边缘     | 弧线 1 4 (0.939 0.342 -0.5)                                  |
| 堵塞       | 顶点标签和网格大小的有序列表 | 十六进制（0 1 2 3 4 5 6 7）     (10 10 1)                  简单分级 (1.0 1.0 1.0) |
| 补丁       | 补丁列表                     | 对称平面底( (0 1 2 3) )                                      |
| 合并补丁对 | 要合并的补丁列表             | 见第 [5.3.2 节](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1920005.3.2) |
|            |                              |                                                              |

表 5.1：*blockMeshDict*中使用的关键字。 

### 5.3.1 编写 blockMeshDict 文件

blockMeshDict文件是使用下述关键字的字典*。*

- 转换为米: 顶点坐标的缩放因子，*例如* 0.001缩放为 mm。
- 顶点: 顶点坐标列表，见 [5.3.1.1](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1870005.3.1.1)节。
- 边缘: 用于描述弯曲的几何形状，见第 [5.3.1.2](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1880005.3.1.2)节。
- 堵塞：顶点标签和网格大小的有序列表，请参阅第 [5.3.1.3](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1890005.3.1.3)节。
- 边界：边界补丁的子字典，见第 [5.3.1.5](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1910005.3.1.5)节。
- 合并补丁对：要合并的补丁列表，请参阅第 [5.3.2 节](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1920005.3.2)。

convertToMeters _关键字指定缩放因子，网格描述中的所有顶点坐标都乘以该因子。例如，


  转换为仪表 0.001；  

表示所有坐标都乘以 0.001，*即**blockMeshDict*文件中引用的值在![毫米](https://cdn.cfd.direct/docs/user-guide-v9/img/user380x.png).

#### 5.3.1.1 顶点

接下来给出网格块的顶点作为名为vertices的标准列表，*例如*对于图 [5.4](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850174)中的示例块，顶点是：


  vertices  (  (  0  0  0  )  // 顶点 号 0  (  1  0  0.1)  // 顶点 号 1  (  1.1  1  0.1)  // 顶点 号 2  (  0  1  0.1)  // 顶点 号 3  (-0.1  -0.1  1  )  / / 顶 点数 4  (  1.3  0  1.2)  // 顶 点数


​        
​       
​        
​      
        5  (  1.4  1.1  1.3)  // 顶点 编号 6  (  0  1  1.1)  // 顶点 编号 7  );


​        


#### 5.3.1.2 边缘

默认情况下，假设连接 2 个顶点的每条边都是直的。但是，任何边缘都可以通过名为edges的列表中的条目指定为弯曲的。该列表是可选的；如果几何图形不包含弯曲边，则可以将其省略。

弯曲边缘的每个条目都以一个关键字开头，该关键字指定下面列出的曲线类型。

- 弧：具有单个插补点或角度+轴的圆弧（见下文）。
- 样条：使用插值点列表的样条曲线
- 折线：一组带有插值点列表的线
- B样条：具有插值点列表的 B 样条曲线
- 线：一条直线，默认不需要边缘规范。

关键字之后是边连接的 2 个顶点的标签。之后，必须指定边缘通过的插值点。对于圆弧，需要以下任一条件：圆弧将相交的单个插值点；或弧的角度和旋转轴。对于spline、polyLine和BSpline，需要一个插值点列表。对于图 [5.4](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850174)中的示例块，我们通过插值点指定连接顶点 1 和 5 的弧边，如下所示![(1.1,0.0,0.5)](https://cdn.cfd.direct/docs/user-guide-v9/img/user381x.png)：


  边 （ 弧 1  5  (1.1  0.0  0.5)  ）；

​    


对于圆弧的角度和轴指定，语法格式为：


  边缘 (  arc  1  5  25  (0  1  0)  //  25 度,  y-normal  );

​    


#### 5.3.1.3 块

块定义包含在名为块的列表中. 每个块定义是一个复合条目，由一个顶点标签列表组成，其顺序在第 [5.3](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850005.3)节中描述，一个向量给出每个方向所需的单元数，每个方向的单元扩展比的类型和列表。

然后块定义如下：


  blocks  (  hex  (0  1  2  3  4  5  6  7)  // 顶 点数 (10  10  10)  // 每个 方向上 的 单元格 数 simpleGrading  (  1  2  3)  // 单元格 扩展 率 );


​           
​     


每个块的定义如下。第一项是形状标识符块的定义，如$ *FOAM* *_ETC-6/cellModels*文件中所定义。形状总是六边形，因为块总是六面体。[下面是一个顶点编号列表，按照第335](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850005.3)页所述的方式排序 .

第二个条目给出了该块的每个方向![x1](https://cdn.cfd.direct/docs/user-guide-v9/img/user382x.png) ![x2](https://cdn.cfd.direct/docs/user-guide-v9/img/user383x.png)和![x3](https://cdn.cfd.direct/docs/user-guide-v9/img/user384x.png)方向的单元数。第三个条目给出了细胞膨胀率对于块中的每个方向。膨胀比使网格可以分级，或细化，在指定的方向。该比率是![δe](https://cdn.cfd.direct/docs/user-guide-v9/img/user385x.png)沿块的一个边缘的结束单元格的宽度与![δ小号](https://cdn.cfd.direct/docs/user-guide-v9/img/user386x.png)沿该边缘的起始单元格的宽度之比，如图 [5.5](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1890135)所示。

*以下每个关键字都指定了blockMesh*中可用的两种分级规范之一。

- 简单分级：simple 选项指定局部 和方向的均匀扩展![x1](https://cdn.cfd.direct/docs/user-guide-v9/img/user387x.png)， 分别只有 3 个扩展比，*例如* simpleGrading (1 2 3)![x2](https://cdn.cfd.direct/docs/user-guide-v9/img/user388x.png)![x3](https://cdn.cfd.direct/docs/user-guide-v9/img/user389x.png) 
- 边缘分级：完整的单元扩展描述给出了块的每个边缘的比率，根据图 [5.4](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850174)所示的方案编号，箭头表示从第一个单元...到最后一个单元的方向，*例如* 
  edgeGrading (1 1 1 1 2 2 2 2 3 3 3 3)
  
  这意味着沿边缘 0-3 的单元格宽度比为 1，沿边缘 4-7 为 2，沿 8-11 为 3，并且直接等效于上面给出的simpleGrading示例。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user390x.png)

图 5.5：沿块边缘的网格分级

#### 5.3.1.4 块的多级分级

使用单一膨胀比来描述网格分级仅允许在网格块内进行“单向”分级。在某些情况下，它降低了复杂性和工作量，以便能够在单个块的单独分区内控制分级，而不是必须定义多个块，每个块一个分级。例如，要对具有两个相对壁的通道进行网格划分并将网格朝向墙壁分级需要三个区域：两个区域对墙壁进行分级，一个在中间没有分级。

OpenFOAM v2.4+ 包括多重分级功能，可以在给定方向划分块并在每个划分中应用不同的分级。这种多重分级是通过替换块的分级规范中的任何单值扩展比来指定的，*例如* ，  “ 1 ”、“ 2 ”、“ 3 ”


块
（ 十六进制 （0  1  2  3  4  5  6  7） （100  300  100） simpleGrading  （1  2  3）；）；

  

我们将为以下示例提供多分级：

- 将块在-方向分成3个部分![是的](https://cdn.cfd.direct/docs/user-guide-v9/img/user391x.png)，分别代表块长度的20%、60%和20%；
- 在第 1 和第 3 部分中包括 y 方向 (300) 上总细胞的 30%，在第 2 部分中包括剩余的 40 *%*；
- 在分区 1 和分区 3 中应用 1:4 扩展，在分区 2 中应用零扩展。

我们可以通过将上面示例中的![是的](https://cdn.cfd.direct/docs/user-guide-v9/img/user391x.png)-direction 扩展比“ 2 ”替换为以下内容来指定这一点：


blocks 
(  hex  (0  1  2  3  4  5  6  7)  (100  300  100)  simpleGrading  (  1  //  x方向 扩展 率 (  (0.2  0.3  4)  //  20%  y-dir,  30%  cells,  expansion  =  4  ( 0.6  0.4  1)  //  60%  y-dir， 40% 单元格， 扩展 =  1  (0.2  0.3  0.25)  //  20%

  


​    
​       
​       
      y-dir,  30%  cells  ,  expansion  =  0.25  (1/4)  )  3  //  z 方向的 膨胀率 ) );


​            


块的部分和单元的部分都自动归一化。它们可以指定为百分比、分数、绝对长度*等* ，并且不需要总和为 100、1*等*。上面的示例可以使用百分比指定，*例如* 


块
（ 十六进制 （0  1  2  3  4  5  6  7） （100  300  100） 简单分级 （ 1  （ （20  30  4） //  20％， 30％...  （60  40  1） （20  30  0.25） ） 3  ）);

  


​    
​       
​      
​      
​    
​    


#### 5.3.1.5 边界

网格的边界在名为边界的列表中给出. 边界被分成补丁（区域），列表中的每个补丁都有它的名称作为关键字，这是用户的选择，尽管我们推荐一些方便识别补丁的东西，*例如* 入口; 该名称用作在现场数据文件中设置边界条件的标识符。然后补丁信息包含在子字典中：

- type : 贴片类型，可以是应用了一些边界条件的通用贴片，也可以是特定的几何条件，如 [5.2.1](https://cfd.direct/openfoam/user-guide/v9-boundaries#x25-1780005.2.1)节中所列；
- faces：组成补丁的块面列表，其名称由用户选择，尽管我们建议使用方便识别补丁的名称，*例如* 入口；该名称用作在现场数据文件中设置边界条件的标识符。

*blockMesh从*边界中省略的任何边界补丁收集面列表并将它们分配给名为defaultFaces类型为*空*的默认补丁。这意味着对于 2 维几何，用户可以选择忽略位于 2D 平面中的块面，因为知道它们将根据需要被收集到一个*空*的补丁中。

回到图 [5.4](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1850174)中的示例块，如果它在左侧面有一个入口，在右侧面有一个输出，并且其他四个面是墙壁，那么补丁可以定义如下：


  边界 // 关键字 ( 入口 // 补丁 名称{ type  patch  ;  // 补丁 0 面 的补丁 类型 (  (0  4  7  3)  // 此 补丁 中的 块 面 ); } // 第 0 个 补丁 定义 结束 outlet  // 补丁 name { type  patch  ;  // 补丁 类型 _       


​    
​       
​      
​      
​        
​      
​             
​          
​    
        1 个 面 （ (1  2  6  5)  ）；} 墙{ 类型 墙； 面 （ (0  1  5  4)  (0  3  2  1)  (3  7  6  2)  (4  5  6  7)  ）；} );


​      
​        
​      
​    
​    
​    
​      
​      
​      
​        
​        
​        
​        
​      
​    


每个块面由 4 个顶点编号的列表定义。给定顶点的顺序**必须**是这样，从块内部看，从任何顶点开始，必须沿顺时针方向遍历面以定义其他顶点。

指定*循环时**blockMesh*中的补丁，用户必须通过neighbourPatch指定相关循环补丁的名称关键词。例如，一对循环补丁可以指定如下：


  左 { 类型 循环； neighbourPatch  right;  面孔 （（0  4  7  3））；} 对{ 类型 循环； neighbourPatch  left； 面孔 （（1  5  6  2））；}


​    
​         

  


​    
​         


### 5.3.2 多个块

可以使用超过 1 个块创建网格。在这种情况下，网格的创建方式如前文所述。唯一的额外问题是块之间的连接。首先，如果一个块的一个面也属于另一个块，则该块面不会形成外部面片，而是生成网格中单元格的一组内部面。

或者，如果用户希望组合彼此不完全匹配的块面，*即*通过共享顶点，他们可以首先将块面包括在补丁列表中。然后可以将要合并其面的每一对补丁包含在名为mergePatchPairs的可选列表中。mergePatchPairs的格式为：


  mergePatchPairs  (  ( < masterPatch > < slavePatch > )  // 合并 补丁 对 0  ( < masterPatch > < slavePatch > )  // 合并 补丁 对 1 …  )


​     
​    


参见例如$ *FOAM* *_TUTORIALS/multiphase/multiphaseEulerFoam/RAS/LBend*。成对的补丁被解释为第一个补丁成为*主*补丁，第二个成为*从*补丁。合并规则如下：

- 主面片的面保持原来的定义，所有顶点都在原来的位置；
- 从面片的面投影到主面片上，从面片和主面片之间有一些分离；
- *块网格*可以调整从面的任何顶点的位置，以消除任何短于最小容差的面边；
- 如果补丁重叠，如图 [5.6](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1920016)所示，每个未合并的面仍然作为原始补丁的外部面，然后必须在其上应用边界条件；
- 如果一个面片的所有面都被合并，那么面片本身将不包含面并被移除。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user393x.png)

图 5.6：合并重叠的补丁

结果是，在合并过程中，从属补丁的原始几何形状不一定会完全保留。因此，在将圆柱块连接到更大块的情况下，将主补丁分配给圆柱体是明智的，以便正确保留其圆柱形状。有一些额外的建议可以确保成功的合并过程：

- 在二维几何中，第三维中的单元格的大小，*即*在二维平面之外，应该与二维平面中单元格的宽度/高度相似；
- 不建议将补丁合并两次， *即*  在mergePatchPairs中包含两次；
- 如果要合并的补丁与要合并的另一个补丁共享公共边缘，则两者都应声明为主补丁。

### 5.3.3 顶点、边和面的投影

*blockMesh*可以配置为使用将顶点、边和/或面投影到指定几何体上来创建适合身体的网格。该功能可用于方便地对球形和圆柱形几何形状（例如管道和容器）进行网格划分。用户可以在可选几何体中的*blockMeshDict*文件中指定*与snappyHexMeshDict*文件中使用的格式相同的字典。例如，要使用内置几何类型指定圆柱体，用户可以使用以下配置：

几何学
{
  圆筒
  {
    输入 可搜索气缸；
    点1  （0  -4  0）；
    点2  （0  4  0）；
    半径 0.7;
  }
};

然后，用户可以使用该项目将顶点、边和/或面投影到圆柱面上使用如下示例语法的关键字：

顶点
(
  项目 （-1  -0.1  -1） （圆柱体）
  项目 (  1  -0.1  -1)  (圆柱体)
  ... 
);

边缘
(
  项目 0  1  （气缸）
  ... 
);

面孔
(
  项目 （0  4  7  3） 气缸
  ... 
);

教程中演示了此功能的使用，可以通过在所有*blockMeshDict*文件中搜索项目关键字来定位，方法是：


  查找$ FOAM _TUTORIALS  -name  blockMeshDict  |  xargs  grep  -l 项目 

### 5.3.4 命名顶点、边、面和块

顶点、边、面和块可以在*blockMeshDict*文件的配置中命名，这样可以更容易管理更复杂的示例。只需使用名称即可完成关键词。以下语法使用上一小节中的投影示例显示命名：

顶点
(
  名称 v0 项目 （-1  -0.1  -1） （圆柱体）
  名称 v1 项目 （ 1  -0.1  -1） （圆柱体）
  ... 
);

边缘
(
  项目 v0  v1  （气缸）
  ... 
);

当为给定实体提供名称时，它可用于替换索引。在示例中，不是使用顶点索引0和1指定边，而是使用名称v0和v1。

### 5.3.5 创建少于 8 个顶点的块

可以将一对或多对顶点相互折叠，以创建一个少于 8 个顶点的块。折叠顶点的最常见示例是在为二维轴对称情况创建 6 面楔形块时使用*楔子*补丁类型在第 [5.2.2](https://cfd.direct/openfoam/user-guide/v9-boundaries#x25-1790005.2.2)节中描述。[使用图5.7](https://cfd.direct/openfoam/user-guide/v9-blockMesh/#x26-1950047)所示示例块的简化版本可以最好地说明该过程 。假设我们希望通过将顶点 7 折叠到 4 和 6 折叠到 5 来创建一个楔形块。这只需通过分别将顶点编号 7 交换 4 和 6 交换 5 来完成，这样块编号将变为：


  十六进制 （0  1  2  3  4  5  5  4）



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user394x.png)

图 5.7：创建一个有 6 个顶点的楔形块

这同样适用于补丁，主要考虑包含折叠顶点的块面，以前(4 5 6 7)现在变为(4 5 5 4)。这是一个零面积的块面，它在*polyMesh*中创建一个没有面的面片，用户可以在这种情况下的*边界*文件中看到。在*blockMeshDict*中，补丁应指定为*空*，因此任何字段的边界条件也应为*空*。

### 5.3.6 跑块Mesh

如第 [3.3](https://cfd.direct/openfoam/user-guide/v9-running-applications#x11-840003.3)节所述，可以在命令行执行以下命令，为< *case* >目录中的案例运行*blockMesh ：*


  blockMesh  -case <案例> 

*块*MeshDict文件必须存在于*系统*（或*constant/polyMesh*）目录中。



## 5.4 使用 snappyHexMesh 实用程序生成网格



本节介绍网格生成实用程序*snappyHexMesh*，随 OpenFOAM 提供。*snappyHexMesh*实用程序生成包含六面体 (hex) 和分裂六面体 (split-hex)的3 维网格自动从立体光刻 (STL) 中的三角表面几何形状或三曲面或波前对象 (OBJ) 格式。通过迭代地细化起始网格并将生成的分裂六边形网格变形到表面，网格大致符合表面。可选阶段将收缩生成的网格并插入单元层。网格细化级别的规范非常灵活，并且表面处理是稳健的，具有预先指定的最终网格质量。它与每次迭代的负载平衡步骤并行运行。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user395x.png)

图 5.8：*snappyHexMesh*的 2D 网格问题示意图

### 5.4.1 snappyHexMesh的网格生成过程



*使用snappyHexMesh*生成网格的过程将使用图 [5.8](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-1970098)中的示意图进行描述。目标是对围绕由三面体描述的对象的矩形区域（图中灰色阴影）进行网格划分，*例如* 典型的外部空气动力学模拟。*请注意，虽然snappyHexMesh*是一个 3D 网格划分工具，但示意图是二维的，以便于理解。

为了运行*snappyHexMesh*，用户需要以下内容：

- 一个或多个位于 case 目录的*constant/triSurface子目录中的三曲面文件；*
- 定义计算域范围和基本级别网格密度的背景六边形网格；通常使用*blockMesh生成，在*[5.4.2](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-1990005.4.2)节中讨论 。
- 一个活泼的*HexMeshDict*字典，带有适当的条目，位于案例的*系统*子目录中。

snappyHexMeshDict字典包括： 控制网格划分过程各个阶段的顶层开关*；*以及每个进程的单独子目录。下面列出了条目。

- 堞形网状：打开堞形网格的创建。
- 折断：打开表面捕捉阶段。
- 添加图层：打开表面层插入。
- 合并容差：合并公差作为初始网格边界框的分数。
- 几何学：使用的所有表面几何的子字典。
- castellatedMeshControls: 堞形网格控件的子字典。
- 快照控件：表面捕捉控件的子字典。
- addLayersControls：图层添加控件的子字典。
- 网格质量控制：网格质量控制的子字典。

*snappyHexMesh*使用的所有几何图形都在*snappyHexMeshDict*字典的*几何*子字典中指定。几何可以通过 OpenFOAM 中的三曲面或边界几何实体来指定。下面给出一个例子：

几何学
{
  sphere1  // 用户 定义的 区域 名称  
  {
    输入 triSurfaceMesh；  
    文件 “sphere1.obj”； // 曲面 几何 OBJ 文件  
    地区
    {
      secondSolid  //  OBJ 文件 中 的 命名 区域      
      {
        命名 mySecondPatch； // 用户自定义 补丁 名称
      }  // 否则 给定 sphere1_secondSolid           
    }
  }

  box1x1x1  // 用户 定义的 区域 名称  
  {
    输入 可搜索框； // 由 边界 框 定义的 区域     
    分钟 （1.5  1  -0.5）；  
    最大值 （3.5  2  0.5）；  
  }

  sphere2  // 用户 定义的 区域 名称  
  {
    输入 可搜索球体； // 由 边界 球 定义的 区域   
    中心 （1.5  1.5  1.5）； 
    半径 1.03； 
  }
};

### 5.4.2 创建背景六角网格



在执行*snappyHexMesh*之前，用户必须创建一个六面体单元的背景网格，该网格填充外部边界内的整个区域，如图 [5.9](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-1990029)所示。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user396x.png)

图 5.9：*snappyHexMesh*网格划分过程中的初始网格生成

这可以简单地使用*blockMesh*来完成。创建背景网格时必须遵守以下标准：

- 网格必须完全由六边形组成；
- 单元纵横比应约为 1，至少在应用后续捕捉程序的表面附近，否则捕捉程序的收敛速度很慢，可能会出现故障；
- 单元格边缘必须至少有一个与三曲面相交，*即*一个单元格的网格将不起作用。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user397x.png)

图 5.10：*snappyHexMesh*网格划分过程中按特征边缘划分的单元格

### 5.4.3 特征边缘和表面处的单元分裂

细胞分裂根据用户在*snappyHexMeshDict的**castellatedMeshControls*子词典中提供的规范执行。*castellatedMeshControls*的条目介绍如下。

- locationInMesh: 待网格化区域内的位置向量；向量在细化之前或期间不得与单元面重合。
- maxLocalCells：细化期间每个处理器的最大单元数。
- maxGlobalCells: 细化期间的整体单元限制（*即*  移除之前）。
- minRefinementCells：如果minRefinementCells ![≥](https://cdn.cfd.direct/docs/user-guide-v9/img/user398x.png)需要细化的单元数，则表面细化停止。
- nCellsBetweenLevels：连续细化级别之间的单元缓冲层数（通常设置为 3）。
- 解析特征角度：对可以看到角度超过resolveFeatureAngle（通常设置为 30）的交叉点的单元应用最大程度的细化。
- 特征：要细化的功能列表。
- 细化曲面：用于细化的表面字典。
- 细化区域：用于细化的区域字典。

[如图5.10](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-19900310)所示，分裂过程首先根据域内指定的边缘特征选择单元格 。特点_*castellatedMeshControls*中的列表子字典允许字典条目包含*边缘网格*文件的名称和细化级别，*例如* ：

特征
(
  {
    文件 “features.eMesh”； // 包含 边缘 网格的 文件
    2级 ； // 细化 级别 _       
  }
);

*可以使用surfaceFeatures*从三曲面文件中提取包含特征的*edgeMes h**通过surfaceFeaturesDict*配置文件指定三面和控制（例如夹角）的实用程序，可以在几个教程和$ *FOAM* *_ETC/caseDicts/surface/surfaceFeaturesDict*中找到其示例。该实用程序只需在终端中执行以下命令即可运行


  表面特征

在特征细化之后，如图 [5.11](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-20004211)所示，在指定表面的局部选择单元进行分裂。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user399x.png)

图 5.11：*snappyHexMesh*网格划分过程中按表面划分的单元格

细化表面*castellatedMeshControls*中的字典需要每个 STL 表面的字典条目以及格式为( < min >< max > )的最小和最大细化的默认级别规范。最低水平通常应用于整个表面；最大级别应用于可以看到形成角度超过resolveFeatureAngle指定角度的交叉点的单元格.

可以可选地在 STL 表面的一个或多个特定区域上覆盖细化。区域条目收集在区域子字典中。每个区域条目的关键字是区域本身的名称，并且细化级别包含在进一步的子字典中。下面给出一个例子：

细化曲面
{
  球体1
  {
    级别 （2  2）； // 整个 表面 的 默认 （最小 最大） 细化
    地区
    {
      第二固体
      {
        等级 （3  3）； //  secondSolid 区域 的 可选 细化
      }
    }
  }
}

### 5.4.4 细胞去除

一旦特征和表面分裂完成，细胞去除过程开始。细胞去除需要一个或多个区域完全被域内的边界表面包围。保留单元格的区域由该区域内的位置向量简单地标识，由 locationInMesh指定*castellatedMeshControls*中的关键字。如果细胞大约有 50% 或更多的体积位于该区域内，则细胞会被保留。如图 [5.12](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-20100412)所示，相应地删除剩余的单元格。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user400x.png)

图 5.12：*snappyHexMesh*网格划分过程中的单元格移除



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user401x.png)

图 5.13：*snappyHexMesh*网格划分过程中按区域划分的单元格

### 5.4.5 指定区域的单元格分裂

位于一个或多个指定体积区域内的那些单元可以进一步分割，如图 [5.13](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-20100513)所示，由深色阴影所示的矩形区域进行分割。细化区域*castellatedMeshControls*中的子字典包含用于细化*几何*子字典中指定的体积区域的条目。细化模式应用于每个区域，可以是：

- 里面在体积区域内细化；
- 外部在体积区域外细化
- 距离根据到表面的距离进行细化；并且可以使用levels关键字在多个距离上容纳不同的级别。

对于细化区域，细化级别由级别指定格式为( < distance >< level > )的条目列表。在内部和外部细化的情况下，<距离>不是必需的，因此被忽略（但必须指定）。示例如下所示：

细化区域
{
  盒子1x1x1
  {
    内部模式 ；
    水平 （（1.0  4））； // 细化 级别 4 （ 忽略 1.0 条目）    
  }

  球体1
  {  //  1.0  m 内的 细化 级别 5              
    模式 距离； //  2.0  m 内的 细化 级别 3      
    水平 （（1.0  5） （2.0  3））； // 级别 必须 从 最近的 第一个开始 排序
  }
}

### 5.4.6 基于局部跨度的细胞分裂



还可以指定单元的细化以保证在相对表面之间的跨度上具有指定数量的单元。这种细化选项可以确保有足够的单元来解析域区域中的流动，例如穿过狭窄的管道。该方法需要在表面几何形状上提供接近度数据。可以通过*surfaceFeatures实用程序使用**surfaceFeaturesDict*文件中的以下条目来计算接近度：

表面
(
  “管道墙.obj”
);

亲近
{
  点接近度 是的；     
}

这会将接近度数据写入到名为*pipeWall.closeness.internalPointCloseness*的文件中，并写入到*constant/triSurface*目录中。*然后通过在snappyHexMeshDict的*细化区域子字典中添加一个条目，将接近度用于基于跨度的细化，*例如* ：

细化区域
{
  管壁
  {
    模式 insideSpan；
    水平 （（1000  2））；
    细胞跨跨度 40；
  }
}

该示例显示了pipeWall表面内的细化区域，其中在距壁 1000 的指定距离内保证最多 2 级细化。基于 span 的细化，由insideSpan指定模式，使用户能够保证至少 40 个cellAcrossSpan，*即* 跨越管道直径。

### 5.4.7 捕捉到曲面



网格划分过程的下一阶段涉及将单元顶点移动到表面几何体上，以从网格中移除锯齿状的堞形表面。过程是：

1. 将堞形边界中的顶点置换到 STL 表面上；
2. 求解具有最新位移边界顶点的内部网格的松弛；
3. 找到导致网格质量参数被违反的顶点；
4. 将这些顶点的位移从它们的初始值（在 1 处）减少并从 2 开始重复，直到满足网格质量。

该方法使用 snappyHexMeshDict 中的*snapControls*子字典中的*设置*，如下所列。

- nSmoothPatch：在找到与表面的对应关系之前的补丁平滑迭代次数（通常为 3）。
- 宽容：被表面特征点或边缘吸引的点的距离与局部最大边缘长度的比值（通常为 2.0）。
- 解算器：网格位移松弛迭代次数（通常为 30-100）。
- nRelaxIter：捕捉松弛迭代的最大次数（通常为 5）。

[图5.14](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-20401814)中的示意图说明了一个示例 （尽管网格运动看起来有点不切实际）。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user402x.png)

图 5.14：*snappyHexMesh*网格划分过程中的表面捕捉

### 5.4.8 网格层



捕捉阶段的网格输出可能适合此目的，尽管它可以沿边界表面产生一些不规则单元。网格划分过程有一个可选阶段，它引入了与边界表面对齐的附加六面体单元层，如图 [5.15](https://cfd.direct/openfoam/user-guide/v9-snappyHexMesh/#x27-20500215)中的深色阴影单元所示。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user403x.png)

图 5.15：*snappyHexMesh*网格划分过程中的层添加

网格层添加的过程包括从边界收缩现有网格并插入单元层，大致如下：

1. 网格在垂直于表面的方向上以指定的厚度从表面向后投射；
2. 用最新的投影边界顶点求解内部网格的松弛；
3. 检查是否满足验证标准，否则减少预计厚度并返回 2；如果任何厚度都不能满足验证，则不要插入层；
4. 如果可以满足验证标准，则插入网格层；
5. 再次检查网格；如果检查失败，层被删除，我们返回到 2。

图层添加过程使用 snappyHexMeshDict 中*addLayersControls*子字典中的*设置*；下面列出了条目。用户可以选择 4 种不同的层厚度参数——expansionRatio、finalLayerThickness、firstLayerThickness、厚度——*他们必须只指定 2 个*；超过 2 个，问题被过度指定。

- 层数：字典指定要插入的层。
- 相对尺寸：开关，设置指定的层厚度是相对于层外的未失真单元大小还是绝对值。
- 膨胀率：层网格的扩展因子，从一层到下一层的尺寸增加。
- finalLayerThickness：离墙最远的层的厚度，通常根据relativeSizes条目结合相对尺寸。
- 第一层厚度：最靠近墙壁的层的厚度，通常与根据relativeSizes条目的绝对尺寸组合。
- 厚度：所有细胞层的总厚度，通常与绝对尺寸相结合，根据
- relativeSizes条目。
- 最小厚度：细胞层的最小厚度，相对或绝对（如上）。
- 成长：如果点没有被挤出，则连接面的层数不会增长；有助于收敛接近特征的层添加。
- 特征角度：不挤压表面的角度。
- nRelaxIter：捕捉松弛迭代的最大次数（通常为 5 次）。
- nSmoothSurfaceNormals：表面法线的平滑迭代次数（通常为 1）。
- n平滑法线：内部网格移动方向的平滑迭代次数（通常为 3）。
- n平滑厚度：表面补丁上的平滑层厚度（通常为 10）。
- maxFaceThicknessRatio：在高度扭曲的细胞上停止层生长（通常为 0.5）。
- maxThicknessToMedialRatio：在厚度与中间距离之比较大（通常为 0.3）的情况下减少层生长
- minMedianAxisAngle：用于拾取中轴点的角度（通常为 90）。
- nBufferCellsNoExtrude：为新层终止创建缓冲区（通常为 0）。
- nLayerIter：层添加迭代的最大总次数（通常为 50）。
- nRelaxedIter：最大迭代次数，之后使用meshQuality的*宽松*子字典中的控件（通常为 20）。

层子字典包含要在其上应用层的每个*补丁*的条目以及所需的表面层数。之所以使用面片名称，是因为添加的层与现有网格有关，而不是表面几何；因此应用于补丁，而不是表面区域。示例层条目如下：

层数
{
  sphere1_firstSolid
  {
    nSurfaceLayers  1；
  }
  最大值
  {
    nSurfaceLayers  1；
  }
}

### 5.4.9 网格质量控制

网格质量由 snappyHexMeshDict 中的*meshQualityControls*子字典中的*条目*控制；下面列出了条目。

- 最大非正交：允许的最大非正交性（度，通常为 65）。
- 最大边界偏度：允许的最大边界面偏度（通常为 20）。
- 最大内部偏度：允许的最大内部面偏度（通常为 4）。
- 最大凹：允许的最大凹度（通常为 80）。
- 最小平面度：最小投影面积与实际面积之比（通常为 0.5）
- 最低质量：细胞分解产生的四面体细胞的最低质量；自 v5.0 以来，当引入新的重心跟踪时，通常通过设置较大的负数来停用，这可以处理负 tets。
- 最小音量：最小单元金字塔体积（通常为 1e-13，大负数禁用）。
- 最小面积：最小面部面积（通常为-1）。
- 最小扭：最小面扭曲（通常为 0.05）。
- 最小行列式：最小归一化细胞行列式；1个![=](https://cdn.cfd.direct/docs/user-guide-v9/img/user404x.png)十六进制；![≤](https://cdn.cfd.direct/docs/user-guide-v9/img/user405x.png)0 = 非法单元格（通常为 0.001）。
- minFaceWeight：0 ![→](https://cdn.cfd.direct/docs/user-guide-v9/img/user406x.png)0.5（通常为 0.05）。
- 最小体积比：0 ![→](https://cdn.cfd.direct/docs/user-guide-v9/img/user406x.png)1.0（通常为 0.01）。
- minTriangleTwist: ![>](https://cdn.cfd.direct/docs/user-guide-v9/img/user408x.png)0 表示*Fluent*兼容性（通常为 -1）。
- nSmoothScale: 误差分布迭代次数（通常为 4）。
- 错误减少：在误差点处按比例缩小位移（通常为 0.75）。
- 轻松：子字典，可以包含上述关键字条目的修改值，以在层添加过程中超过nRelaxedIter时使用。



## 5.5 网格转换

用户可以使用其他包生成网格并将它们转换为 OpenFOAM 使用的格式。[3.6.3](https://cfd.direct/openfoam/user-guide/v9-standard-utilities#x14-1120003.6.3)节列出了许多网格转换实用程序 。下面列出了一些更流行的网格转换器，本节介绍了它们的用途。

- *fluentMeshToFoam*

  读取*Fluent* .msh网格文件，适用于 2-D 和 3-D 情况；

- *starToFoam*

  读取*STAR-CD* / *PROSTAR*网格文件。

- *开局泡沫*

  读取*GAMBIT* .neu中性文件；

- *创意泡沫*

  读取以*ANSYS* .ans格式编写的*I-DEAS*网格；

- *cfx4ToFoam*

  读取以.geo格式编写的*CFX*网格；

### 5.5.1 fluentMeshToFoam

*Fluent将网格数据写入扩展名为**.msh*的单个文件。该文件必须以 ASCII 格式写入，这不是*Fluent*中的默认选项。可以转换单流*Fluent*网格，包括二维几何。在 OpenFOAM 中，目前通过定义 3 维网格来处理 2 维几何图形，其中前平面和后平面被定义为*空*边界补丁类型。读取二维*Fluent*网格时，转换器会自动在第三方向拉伸网格并添加空面片，将其命名为frontAndBackPlanes。

还应注意以下特点。

- OpenFOAM 转换器将尝试尽可能多地捕获*Fluent*边界条件定义；*但是，由于 OpenFOAM 和Fluent*边界条件之间没有明确、直接的对应关系，因此用户应在运行案例之前检查边界条件。
- 目前不支持从二维网格创建轴对称网格，但可以根据要求实施。
- 不允许使用多个材质网格。如果存在多种流体材料，它们将被转换为单个 OpenFOAM 网格；如果检测到实心区域，转换器将尝试将其过滤掉。
- *Fluent*允许用户定义网格内部的面片，*即*由两侧带有单元的面组成。OpenFOAM 中不允许使用此类补丁，转换器将尝试将其过滤掉。
- 目前不支持嵌入式接口和细化树。

转换*Fluent* *.msh*文件的过程首先是通过创建必要的目录/文件来创建一个新的 OpenFOAM 案例：在*系统*子目录中包含*controlDict*文件的案例目录。然后在命令提示符下，用户应该执行：


  fluentMeshToFoam <网格文件> 

其中< meshFile >是 .msh 文件的名称*，*包括完整路径或相对路径。

### 5.5.2 starToFoam

本节介绍如何将*STAR-CD*代码上生成的网格转换为 OpenFOAM 网格类可以读取的形式。网格可以由*STAR-CD*提供的任何软件包生成，*即* *PROSTAR*、*SAMM*、*ProAM*及其衍生产品。该转换器接受任何单流网格，包括整体和任意耦合匹配，并且支持所有单元类型。转换器不支持的功能有：

- 多流网格规范；
- 挡板，*即*插入域中的零厚度墙；
- 部分边界，其中一对匹配的未覆盖部分被视为边界面；
- 滑动界面。

对于多流网格，可以通过将每个单独的流写入单独的网格并在 OpenFOAM 中重新组合它们来实现网格转换。

OpenFOAM 采用仅接受符合第 [5.1](https://cfd.direct/openfoam/user-guide/v9-mesh-description#x24-1680005.1)节中规定的相当严格的有效性标准的输入网格的策略。它根本不会使用无效的网格运行，也不能转换本身无效的网格。*以下部分描述了使用STAR-CD*提供的网格生成包生成网格时必须采取的步骤，以确保可以将其转换为 OpenFOAM 格式。为避免在本节的其余部分重复，随*STAR-CD*提供的网格生成工具将统称为*STAR-CD*。

#### 5.5.2.1 关于转换的一般建议

我们强烈建议用户在尝试进行*starToFoam转换之前运行**STAR-CD*网格检查工具，并在转换后*运行 checkMesh*实用程序应在新转换的网格上运行。或者，*starToFoam*本身可能会发出包含*PROSTAR*命令的警告，使用户能够更仔细地查看有问题的单元格。在尝试将网格与 OpenFOAM 一起使用之前，应检查并修复有问题的单元格和匹配项。请记住，无效的网格不会与 OpenFOAM 一起运行，但它可能会在另一个不强加有效性标准的环境中运行。

公差匹配的一些问题可以通过在转换器中使用匹配公差来克服。但是，其有效性存在限制，并且明显需要从其默认级别增加匹配容差，这表明原始网格存在不准确性。

#### 5.5.2.2 消除无关数据

网格生成完成后，移除所有无关顶点并压缩单元边界和顶点编号，假设已创建流体单元并丢弃所有其他单元。这是通过以下*PROSTAR*命令完成的：


  CSET 新闻 流体 CSET  INVE


CSET应为空。如果不是这种情况，请检查CSET中的单元格并调整模型。如果确实不需要这些单元格，可以使用*PROSTAR*命令删除它们：


  CDEL  CSET

同样，顶点也需要被丢弃：


  CSET 新闻 流体 VSET 新闻 CSET  VSET  INVE

  

在丢弃这些不需要的顶点之前，必须在清除之前收集不需要的边界面：


  CSET 新闻 流体 VSET 新闻 CSET  BSET 新闻 VSET  ALL  BSET  INVE

  


如果BSET不为空，则可以使用以下方法删除不需要的边界面：


  BDEL  BSET

此时，模型应该只包含流体单元和支撑顶点，以及定义的边界面。所有边界面都应完全由单元格的顶点支撑，如果不是这种情况，请继续清理几何体，直到一切都干净为止。

#### 5.5.2.3 删除默认边界条件

默认情况下，*STAR-CD*将墙边界分配给未明确与边界区域关联的任何边界面。剩余的边界面被收集到默认边界区域中，分配的边界类型为*0*。OpenFOAM 故意没有为未定义的边界面提供默认边界条件的概念，因为它会引起人为错误，*例如*，无法检查我们是否打算为所有未关联的面提供默认条件。

因此，必须指定每个 OpenFOAM 网格的**所有边界才能成功转换网格。**需要使用以下描述的过程将默认边界转换为真实边界：

1. 使用Wire Surface选项绘制几何图形。

2. 

   使用与默认

   区域 0相同的参数定义一个额外的边界区域，并将所有可见面添加到新区域中，例如 10，方法是在边界工具中选择一个区域选项并在模型的整个屏幕绘图周围绘制一个多边形。这可以通过在

   PROSTAR

   中发出以下命令来完成：

     RDEF  10 墙 BZON  10 全部
   
3. 我们将从集合中删除所有先前定义的边界类型。穿过边界区域：

     BSET  NEWS  REGI  1  BSET  NEWS  REGI  2 …  3,  4, …
     
      

   收集与边界集关联的顶点，然后收集与顶点关联的边界面（它们的数量将是原始集合中的两倍）。

     BSET  NEWS  REGI  1  VSET  NEWS  BSET  BSET  NEWS  VSET  ALL  BSET  DELE  REGI  1  REPL
   
     
   
     

   这应该给出边界区域 10 的面，这些面已在边界区域 1 的顶部定义。使用

   BDEL BSET

   删除它们。对所有区域重复这些操作。

#### 5.5.2.4 重新编号模型

使用以下命令重新编号并检查模型：


  CSET  NEW  FLUID  CCOM  CSET  VSET  NEWS  CSET  VSET  INVE  （应 为 空！） VSET  INVE  VCOM  VSET  BSET  NEWS  VSET  ALL  BSET  INVE  （也应 为 空 ！） BSET  INVE  BCOM  BSET  CHECK  ALL  GEOM

  

  

  

  

  


内部*PROSTAR*检查由最后两个命令执行，这可能会揭示一些其他不可预见的错误。此外，请注意比例因子，因为*PROSTAR*仅将因子应用于*STAR-CD*而不是几何。如果因子不是 1，则使用*scalePoints*OpenFOAM 中的实用程序。

#### 5.5.2.5 写出网格数据

网格完成后，将模型的所有积分匹配放入耦合类型 1。所有其他类型将用于表示任意匹配。


  CPSET 新闻 类型 INTEGRAL  CPMOD  CPSET  1


然后必须将计算网格的组件写入它们自己的文件。这是通过发出命令使用*PROSTAR作为边界来完成的*


  写

默认情况下，这会写入*.23*文件（3.0 之前的版本）或*.bnd*文件（3.0 及更高版本）。对于单元格，命令


  写

将单元格输出到*.14*或*.cel*文件，对于顶点，命令


  写

输出到*.15*或*.vrt*文件。当前默认设置以 ASCII 格式写入文件。如果存在情侣，则需要通过键入以下内容写出带有扩展名*.cpl的附加情侣文件：*


  CPWRITE

输出到三个文件后，退出*PROSTAR*或关闭文件。查看面板并记下所有使用的*STAR-CD*子模型、材料和流体属性——材料属性和数学模型需要通过创建和编辑 OpenFOAM 字典文件来设置。

转换*PROSTAR*文件的过程首先是通过创建必要的目录来创建一个新的 OpenFOAM 案例。*PROSTAR*文件必须存储在同一目录中，并且用户必须更改文件扩展名：从.23 *、* .14*和*.15 *（*低于*STAR-CD*版本 3.0）或*.pcs*、*.cls*和*.vtx*（*STAR-CD* 3.0及以上版本）；分别为*.bnd*、*.cel*和*.vrt*。

#### 5.5.2.6 .vrt 文件的问题

.vrt文件以指定宽度的数据列写入，而不是自由格式*。*典型的数据行可能如下所示，给出一个顶点编号，后跟坐标：


  19422  -0.105988957  -0.413711881E-02  0.000000000E+00    

如果纵坐标以科学计数法书写并且为负数，则值之间可能没有空格，*例如* ：


  19423  -0.953953117E-01-0.338810333E-02  0.000000000E+00   

starToFoam转换器使用空格来分隔纵坐标值*来*读取数据，因此在读取前面的示例时会反对。因此，OpenFOAM 包含一个简单的脚本，*foamCorrectVrt*在必要时在值之间插入一个空格，*即将*前面的示例转换为：


  19423  -0.953953117E-01  -0.338810333E-02  0.000000000E+00   

因此，如果需要，应该在运行*starToFoam转换器之前执行**foamCorrectVrt*脚本，方法是键入：


  泡沫正确Vrt <文件> .vrt 

#### 5.5.2.7 将网格转换为 OpenFOAM 格式

现在可以运行转换器实用程序*starToFoam来创建 OpenFOAM 运行所需的边界、单元和点文件：*


   starToFoam <网格文件前缀> 

其中< meshFilePrefix >是网格文件的前缀名称，包括完整路径或相对路径。实用程序完成运行后，应通过手动编辑*边界*文件来指定 OpenFOAM 边界类型。

### 5.5.3 开局泡沫

*GAMBIT将网格数据写入扩展名为**.neu*的单个文件。转换*GAMBIT* *.neu*文件的过程是首先创建一个新的 OpenFOAM 案例，然后在命令提示符下，用户应该执行：


  gambitToFoam <网格文件> 

其中< meshFile >是*.neu*文件的名称，包括完整路径或相对路径。

*GAMBIT*文件格式不提供关于边界补丁类型的信息，例如*墙*、对称平面、循环。因此所有的补丁都被创建为类型补丁。请根据需要在网格转换后重新设置。

### 5.5.4 创意泡沫

OpenFOAM 可以转换由*I-DEAS*生成但以*ANSYS*格式写成*.ans*文件的网格。转换*.ans*文件的过程是首先创建一个新的 OpenFOAM 案例，然后在命令提示符下，用户应该执行：


  ideaToFoam <网格文件> 

其中< meshFile >是*.ans*文件的名称，包括完整路径或相对路径。

### 5.5.5 cfx4ToFoam

*CFX将网格数据写入扩展名为**.geo*的单个文件。*CFX*中的网格格式是块结构的，*即*网格被指定为一组具有粘合信息和顶点位置的块。OpenFOAM 将转换网格并尽可能捕捉*CFX边界条件。**CFX*中的 3 维“补丁”定义，包含有关多孔、实体区域*等*的信息，将被忽略，所有区域都被转换为单个 OpenFOAM 网格。*CFX*支持“默认”面片的概念，其中没有定义边界条件的每个外部面都被视为*墙*. 这些面由转换器收集并放入OpenFOAM 网格中的defaultFaces补丁中，并给定类型*wall*；当然，补丁类型可以随后更改。

就像，*CFX*中的 OpenFOAM 2 维几何被创建为 1 个单元厚度的 3 维网格。如果用户希望在*CFX*创建的网格上运行 2 维案例，则前面板和后面板的边界条件应设置为*空*；用户应确保计算平面中所有其他面上的边界条件设置正确。目前没有从二维*CFX*网格创建轴对称几何的工具。

转换*CFX* *.geo*文件的过程是首先创建一个新的 OpenFOAM 案例，然后在命令提示符下，用户应该执行：


  cfx4ToFoam <网格文件> 

其中< meshFile >是*.geo*文件的名称，包括完整路径或相对路径。



## 5.6 不同几何之间的映射字段



地图*字段*实用程序将与给定几何相关的一个或多个字段映射到另一个几何的相应字段。它是完全概括的，以至于与字段相关的几何形状之间不需要任何相似性。但是，对于几何形状一致的情况，可以使用简化映射过程的特殊选项执行*mapFields 。*

对于我们对*mapFields*的讨论，我们需要定义一些术语。首先，我们说数据是从*源*映射到*目标*的。如果源字段和目标字段的几何*和*边界类型或条件相同，则认为这些字段是*一致的。**mapFields*映射的字段数据是controlDict中startFrom / startTime指定的时间目录内的*字段*的目标案例。数据从源案例的等效时间目录中读取，并映射到目标案例的等效时间目录。

### 5.6.1 映射一致的字段

通过使用-consistent命令行选项在（目标）案例上执行*mapFields*可以简单地执行一致字段的映射，如下所示：


  mapFields <源 目录> -一致 

### 5.6.2 映射不一致的字段

当字段不一致时，如图 [5.16](https://cfd.direct/openfoam/user-guide/v9-mapFields/#x29-22200316)所示，*mapFields*需要在目标案例的*系统*目录下有一个*mapFieldsDict*字典。以下规则适用于映射：

- 尽可能将现场数据从源映射到目标，*即*在我们的示例中，目标几何中的所有现场数据都从源映射，阴影区域中的那些保持不变；
- 除非在*mapFieldsDict*字典中另有说明，否则补丁字段数据保持不变。

mapFieldsDict字典包含两个指定补丁数据映射的列表*。*第一个列表是patchMap它指定几何上重合的源和目标补丁对之间的数据映射，如图 [5.16](https://cfd.direct/openfoam/user-guide/v9-mapFields/#x29-22200316)所示。该列表包含每对源补丁和目标补丁的名称。第二个列表是cuttingPatches，其中包含目标补丁的名称，其值将从源内部字段映射，目标补丁通过该域进行剪切。在目标补丁只穿过源内部字段的一部分的情况下，*例如*我们示例中的左下目标补丁，内部字段内的值被映射，而外部的值保持不变。



![img](https://cdn.cfd.direct/docs/user-guide-v9/img/user409x.png)

图 5.16：映射不一致的字段

示例*mapFieldsDict*字典如下所示：

16
17 patchMap  （盖子 移动墙）；    
18
19个cuttingPatches  (); 
20
21
22 //  ***************************************************** ******************************  //


  mapFields <源 目录> 

### 5.6.3 映射并行案例

*如果源案例和目标案例中的一个或两个被分解为并行运行，则在执行mapFields*时必须提供其他选项：

- -并行源

  如果源案例被分解为并行运行；

- -并行目标

  如果目标案例被分解为并行运行。



